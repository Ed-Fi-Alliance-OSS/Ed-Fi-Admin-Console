# SPDX-License-Identifier: Apache-2.0
# Licensed to the Ed-Fi Alliance under one or more agreements.
# The Ed-Fi Alliance licenses this file to you under the Apache License, Version 2.0.
# See the LICENSE and NOTICES files in the project root for more information.
version: "3.8"

services:
  nginx:
    profiles: ["default"]
    build:
      context: ./nginx
      dockerfile: Dockerfile
    environment:
      ODS_VIRTUAL_NAME: ${ODS_VIRTUAL_NAME:-api}
      ADMIN_API_VIRTUAL_NAME: ${ADMIN_API_VIRTUAL_NAME:-adminapi}
      ADMIN_CONSOLE_VIRTUAL_NAME: ${ADMIN_CONSOLE_VIRTUAL_NAME:-adminconsole}
      KEYCLOAK_VIRTUAL_NAME: ${KEYCLOAK_VIRTUAL_NAME:-auth}
    ports:
      - '443:443'
    container_name: ed-fi-gateway
    restart: always
    hostname: nginx
    volumes:
      - ./ssl:/ssl/
      - shared_data:/usr/share/nginx/html/adminconsole
    depends_on:
      - api
      - adminapi
      - admin-console
      - idp-keycloak

